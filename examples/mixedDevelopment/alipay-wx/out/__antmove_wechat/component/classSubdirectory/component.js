"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function judgeType(e){return void 0===e?null:"number"==typeof e?Number:"string"==typeof e?String:"boolean"==typeof e?Boolean:"function"==typeof e?Function:null===e?null:"object"===_typeof(e)?Array.isArray(e)?Array:Object:void 0}function transformProps(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t={},r=Object.assign({},e);for(var o in r){var i=judgeType(r[o]);"Function"!==i&&(t=Object.assign(t,_defineProperty({},o,{type:i,value:r[o]})))}return t}function processCustomEvent(){var e=this,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).props||{},i=this,r=Object.assign({},t);for(var n in r)n.match(/on[A-Z]\w*/)&&function(){var o=n.substring(2);o=o.toLowerCase(),e.props[n]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.triggerEvent(o,_objectSpread({},t),{})}}()}function makeLifes(n,a){a.deriveDataFromProps&&console.warn("生命周期 deriveDataFromProps 不支持更新前触发情景");[{original:"onInit",target:"attached"},{original:"didUnmount",target:"detached"},{original:"didMount",target:"ready"}].forEach(function(e){var t=a[e.original],r=a[e.target];"attached"===e.target?n[e.target]=function(){var o=this;if(a.didUpdate){var i=this.setData;this.setData=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},r=JSON.stringify(o.data);return i.call(o,e,function(){n.behaviorUpdate&&Object.values(n.behaviorUpdate).forEach(function(e){e.call(o,o.properties,JSON.parse(r))}),a.didUpdate.call(o,o.properties,JSON.parse(r)),t()})}}this.props=this.data,processCustomEvent.call(this,a),n.props=Object.assign({},this.props),this.$page={},t&&t.call(this),r&&r.call(this)}:n[e.target]=function(){"ready"===e.target&&(this.$id=this.__wxExparserNodeId__,this.is=""),t&&t.call(this),r&&r.call(this)},delete a[e.original],delete a[e.target]})}function makeMixin(a){if(a.mixins){var r=[],s=["onInit","didMount","didUpdate","didUnmount","data","props","methods"];!function e(t){(0<arguments.length&&void 0!==t?t:[]).forEach(function(i){var n={};i.mixins&&e(i.mixins),i.deriveDataFromProps&&console.warn("生命周期 deriveDataFromProps 不支持更新前触发情景"),Object.keys(i).forEach(function(e,t){if(s.includes(e))if("props"===e){var r=transformProps(i.props);i.properties=i.properties||{},n.properties=Object.assign(i.properties,r)}else if("didUpdate"===e){a.behaviorUpdate={};var o=_defineProperty({},e+t,i[e]);a.behaviorUpdate=Object.assign(a.behaviorUpdate,o)}else n[e]=i[e]}),r.push(Behavior(n))})}(a.mixins),a.behaviors=r,delete a.mixins}}function makeEventObj(e,t){if(t.methods){var i=t.methods,r={};Object.keys(i).forEach(function(o){r[o]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t[0]&&t[0].target?(t[0].target.dataset=_objectSpread({},t[0].currentTarget.dataset)||{},i[o].call(this,t[0])):i[o].apply(this,t)}}),e.methods=r}}function makeProperties(e){e.properties=e.properties||{};var t=transformProps(e.props);e.properties=Object.assign(e.properties,t),e.options={multipleSlots:!0}}function addObserver(n){if(!n.didUpdate)return!1;n.properties&&Object.keys(n.properties).map(function(i){n.properties[i]&&(n.properties[i].observer=function(e,t){var r=this,o=_objectSpread({},n.props);this.props=Object.assign({},n.props),this.props[i]=e,o[i]!==t&&(n.behaviorUpdate&&Object.values(n.behaviorUpdate).forEach(function(e){e.call(r,o,r.data)}),n.didUpdate.call(this,o,this.data))})})}module.exports={processTransformationComponent:function(e,t){return makeLifes(e,t),makeEventObj(e=Object.assign(e,t),t),makeMixin.call(e,e),makeProperties(e),addObserver(e),e}};